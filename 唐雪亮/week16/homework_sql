from py2neo import Graph
from py2neo.errors import Neo4jError

# 1. ä¼˜åŒ–è¿æ¥åè®®ï¼ˆbolt:// æ¯” neo4j:// æ›´ç¨³å®šï¼‰
try:
    graph = Graph("neo4j://127.0.0.1:7687", auth=("neo4j", "12345678"))
    print("âœ… æˆåŠŸè¿æ¥åˆ° Neo4j æ•°æ®åº“")
except Neo4jError as e:
    print(f"âŒ è¿æ¥å¤±è´¥ï¼š{e}")
    exit()

# 2. åˆå¹¶æ‰€æœ‰ CREATE ä¸ºä¸€ä¸ªè¯­å¥ï¼ˆå…³é”®ä¿®å¤ç‚¹ï¼‰
cypher = """
// åˆå¹¶æ‰€æœ‰åˆ›å»ºé€»è¾‘ä¸ºä¸€ä¸ª CREATE è¯­å¥ï¼Œç¡®ä¿èŠ‚ç‚¹å˜é‡å¯è·¨éƒ¨åˆ†å¼•ç”¨
CREATE 
  // åˆ›å»ºç”¨æˆ·èŠ‚ç‚¹
  (u1:User {
    userId: 1001,
    username: "å¼ ä¸‰",
    age: 28,
    gender: "ç”·",
    registerTime: "2024-01-15",
    city: "åŒ—äº¬",
    vipLevel: 2
  }),
  (u2:User {
    userId: 1002,
    username: "æå››",
    age: 32,
    gender: "å¥³",
    registerTime: "2024-02-20",
    city: "ä¸Šæµ·",
    vipLevel: 3
  }),
  // åˆ›å»ºå•†å“èŠ‚ç‚¹
  (p1:Product {
    productId: 2001,
    name: "åä¸ºMate70 Pro",
    price: 6999.00,
    category: "æ‰‹æœº",
    stock: 500,
    brand: "åä¸º",
    releaseTime: "2024-09-01"
  }),
  (p2:Product {
    productId: 2002,
    name: "å°ç±³æ‰‹ç¯9",
    price: 299.00,
    category: "æ™ºèƒ½ç©¿æˆ´",
    stock: 2000,
    brand: "å°ç±³",
    releaseTime: "2024-08-15"
  }),
  (p3:Product {
    productId: 2003,
    name: "è‹¹æœAirPods Pro2",
    price: 1899.00,
    category: "è€³æœº",
    stock: 1000,
    brand: "è‹¹æœ",
    releaseTime: "2024-07-10"
  }),
  // åˆ›å»ºè®¢å•èŠ‚ç‚¹
  (o1:Order {
    orderId: 3001,
    orderTime: "2024-10-01 10:30:00",
    totalAmount: 7298.00,
    payStatus: "å·²æ”¯ä»˜",
    deliveryStatus: "å·²å‘è´§"
  }),
  (o2:Order {
    orderId: 3002,
    orderTime: "2024-10-05 15:20:00",
    totalAmount: 1899.00,
    payStatus: "å·²æ”¯ä»˜",
    deliveryStatus: "å¾…å‘è´§"
  }),
  // åˆ›å»ºå…³ç³»ï¼ˆæ­¤æ—¶ u1ã€p1ã€o1 ç­‰å˜é‡ä»æœ‰æ•ˆï¼‰
  (u1)-[:CREATE_ORDER {createTime: "2024-10-01 10:30:00"}]->(o1),
  (o1)-[:CONTAINS {quantity: 1, unitPrice: 6999.00}]->(p1),
  (o1)-[:CONTAINS {quantity: 1, unitPrice: 299.00}]->(p2),
  (u2)-[:CREATE_ORDER {createTime: "2024-10-05 15:20:00"}]->(o2),
  (o2)-[:CONTAINS {quantity: 1, unitPrice: 1899.00}]->(p3),
  (u1)-[:FAVORITE {favoriteTime: "2024-09-10"}]->(p3);
"""

# 3. æ‰§è¡Œ Cypher è¯­å¥å¹¶æ•è·å¼‚å¸¸
try:
    result = graph.run(cypher)
    # æ‰“å°æ‰§è¡Œç»“æœï¼ˆéªŒè¯æ˜¯å¦æˆåŠŸï¼‰
    print(f"ğŸ“ è¯­å¥æ‰§è¡ŒæˆåŠŸï¼")
except Neo4jError as e:
    print(f"âŒ æ‰§è¡Œå¤±è´¥ï¼š{e}")

# 4. å¯é€‰ï¼šæŸ¥è¯¢éªŒè¯æ•°æ®
verify_cypher = "MATCH (u:User) RETURN u.userId, u.username LIMIT 2"
verify_result = graph.run(verify_cypher).data()
for record in verify_result:
    print(f"âœ… éªŒè¯æ•°æ®ï¼šç”¨æˆ·ID={record['u.userId']}ï¼Œç”¨æˆ·å={record['u.username']}")
